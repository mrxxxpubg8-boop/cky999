<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>加拿大28历史数据展示</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f8f8f8; margin:0; padding:0; }
h1 { margin-top:20px; font-size:28px; font-weight:bold; }
button { padding:5px 10px; cursor:pointer; font-size:16px; }
table { border-collapse: collapse; margin:auto; width:90%; background:#fff; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; font-weight:bold; }
th { background:#eee; }
</style>
</head>
<body>

<h1>加拿大28历史数据 (最新 25 期) v2</h1>
<button onclick="loadData()">刷新数据</button>

<table id="historyTable">
    <tr><th>期号</th><th>号码</th><th>和值</th></tr>
</table>

<script>
// 工具函数：数组求和
function sum(arr){ return arr.reduce((a,b)=>a+b,0); }

// 获取单期数据
async function fetchQihao(qihao){
    try{
        const resp = await fetch('https://pc28.me/home/index/getjnd', {
            method:'POST',
            headers: {'Content-Type':'application/x-www-form-urlencoded'},
            body: `qihao=${qihao}`
        });
        const data = await resp.json();
        if(data.code===1) return data.data;
    } catch(e){ console.error(e); }
    return null;
}

// 获取最新期号
async function getLatestQihao(){
    // 官方网页首页一般有最新期号，可以抓取首页 HTML
    try{
        const resp = await fetch('https://pc28.me/?lang=en-us');
        const html = await resp.text();
        const match = html.match(/期号\s*[:：]\s*(\d+)/);
        if(match) return parseInt(match[1]);
    } catch(e){ console.error(e); }
    return null;
}

// 加载历史 25 期
async function loadData(){
    const table = document.getElementById('historyTable');
    table.innerHTML = '<tr><th>期号</th><th>号码</th><th>和值</th></tr>';

    let latest = await getLatestQihao();
    if(!latest) latest = 3345672; // 如果抓不到，使用默认

    const start = latest - 24; // 最新 + 历史 24 期 = 25 期
    for(let q=start; q<=latest; q++){
        const data = await fetchQihao(q);
        if(data){
            const nums = data.hao.slice(0,3).join(' + ');
            const total = data.he;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${q}</td><td>${nums}</td><td>${total}</td>`;
            table.appendChild(tr);
        }
    }
}
</script>

</body>
</html>
