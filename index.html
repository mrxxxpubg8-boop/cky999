<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>SZ28 @SZ28BOT</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f8f8f8; }
h1 { margin-top:20px; font-size:28px; font-weight:bold; }
button { padding:5px 10px; margin-bottom:20px; cursor:pointer; font-size:16px; }

#infoBoxes {
    display:flex; 
    justify-content:center; 
    gap:20px; 
    margin-bottom:20px;
}

.infoBox {
    background:#e0f0ff; 
    padding:10px 20px; 
    border-radius:10px; 
    font-size:20px; 
    font-weight:bold;
}

table { border-collapse: collapse; margin:auto; width:95%; background:#fff; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; font-weight:bold; }
th { background:#eee; }
.correct { color: green; }
.wrong { color: red; }

footer { 
    margin-top:30px; 
    font-size:42px;  
    font-weight:bold; 
    color:#fff;
    background: linear-gradient(to right, #1e3c72, #2a5298); 
    padding:15px 0;
    border-radius:12px;
}
</style>
</head>
<body>
<h1>SZ28 @SZ28BOT</h1>
<button onclick="loadData()">åˆ·æ–°æ•°æ®</button>

<div id="infoBoxes">
    <div class="infoBox"><span id="nextPred1">åŠ è½½ä¸­...</span></div>
    <div class="infoBox"><span id="nextPred2">åŠ è½½ä¸­...</span></div>
    <div class="infoBox"><span id="winRate">åŠ è½½ä¸­...</span></div>
</div>

<h2>æœ€è¿‘ 20 æœŸé¢„æµ‹ç»“æœ</h2>
<table id="historyTable">
<tr>
<th>æœŸå·</th>
<th>ç®—æ³•1é¢„æµ‹</th>
<th>ç®—æ³•2é¢„æµ‹</th>
<th>å¼€å¥–å’Œå€¼</th>
<th>ç»“æœ</th>
</tr>
</table>

<footer>BY CKY</footer>

<script>
// æ±‚æ•°ç»„å’Œ
function sum(arr){ return arr.reduce((a,b)=>a+b,0); }

// ç®—æ³•1 (åŸæ¥çš„)
function calcPrediction1(last3){
    let a = (sum(last3[2])+last3[2][0])/0.28 +
            (sum(last3[1])+last3[1][0])/0.28 +
            (sum(last3[0])+last3[0][0])/0.28;
    let b = Math.sqrt(a);
    let c = b / 3;
    let decimal = c.toFixed(3).split('.')[1];
    let digitSum = decimal.split('').reduce((s,d)=>s+parseInt(d),0);
    if(digitSum<14){
        return digitSum%2===0?'æ€å¤§åŒ':'æ€å¤§å•';
    }else{
        return digitSum%2===0?'æ€å°åŒ':'æ€å°å•';
    }
}

// ç®—æ³•2 (Pythonå…¬å¼æ¬è¿‡æ¥çš„)
function calcPrediction2(last3){
    let a = (sum(last3[2])+last3[2][0])/4 +
            (sum(last3[1])+last3[1][0])/4 +
            (sum(last3[0])+last3[0][0])/4;
    let b = Math.sqrt(a);
    let c = b / 28;
    let decimal = c.toFixed(3).split('.')[1];
    let digitSum = decimal.split('').reduce((s,d)=>s+parseInt(d),0);
    if(digitSum<14){
        return digitSum%2===0?'æ€å°åŒ':'æ€å°å•';
    }else{
        return digitSum%2===0?'æ€å¤§åŒ':'æ€å¤§å•';
    }
}

// åˆ¤æ–­èƒœè´Ÿ
function checkWin(pred, total){
    let size = total>=14?'å¤§':'å°';
    let parity = total%2===1?'å•':'åŒ';
    let combo = size+parity;
    if(pred==='æ€å°å•' && combo!=='å°å•') return 'âœ…';
    if(pred==='æ€å°åŒ' && combo!=='å°åŒ') return 'âœ…';
    if(pred==='æ€å¤§å•' && combo!=='å¤§å•') return 'âœ…';
    if(pred==='æ€å¤§åŒ' && combo!=='å¤§åŒ') return 'âœ…';
    return 'âŒ';
}

// è·å– JSON
async function fetchJSON(url){
    try{
        const resp = await fetch(url);
        return await resp.json();
    }catch(e){ console.error(e); return null;}
}

// åŠ è½½æ•°æ®
async function loadData(){
    const latestData = await fetchJSON('https://pc28.help/kj.json');
    if(!latestData || !latestData.data){
        alert("è·å–æ•°æ®å¤±è´¥");
        return;
    }
    const latestQihao = parseInt(latestData.data[0].qihao);
    const recordDict = {};
    for(let q=latestQihao-22;q<=latestQihao;q++){
        const rec = await fetchJSON(`https://pc28.help/qihao/${q}`);
        if(rec && rec.data){
            const nums = rec.data[0].opennum.replace(/,/g,'+').split('+').map(Number).slice(0,3);
            if(nums.length>=3) recordDict[q] = nums;
        }
    }

    const sortedQihao = Object.keys(recordDict).map(Number).sort((a,b)=>b-a); // æ–°â†’æ—§
    const historyTable = document.getElementById('historyTable');
    historyTable.innerHTML='<tr><th>æœŸå·</th><th>ç®—æ³•1é¢„æµ‹</th><th>ç®—æ³•2é¢„æµ‹</th><th>å¼€å¥–å’Œå€¼</th><th>ç»“æœ</th></tr>';

    let winCount=0;
    const testQihaoList = sortedQihao.slice(0,20);

    for(let cur of testQihaoList){
        const prev3 = sortedQihao.filter(q=>q>cur).slice(0,3).map(q=>recordDict[q]);
        if(prev3.length<3) continue;
        const pred1 = calcPrediction1(prev3);
        const pred2 = calcPrediction2(prev3);
        const total = sum(recordDict[cur]);
        const res = checkWin(pred1, total);
        if(res==='âœ…') winCount++;
        const tr = document.createElement('tr');
        let resHTML = res;
        if((winCount/testQihaoList.length*100)>=80 && res==='âœ…') resHTML+=' ğŸ”¥';
        tr.innerHTML=`<td>${cur}</td><td>${pred1}</td><td>${pred2}</td><td>${total}</td><td>${resHTML}</td>`;
        historyTable.appendChild(tr);
    }

    // æœ€æ–°é¢„æµ‹
    const latest3 = sortedQihao.slice(0,3).map(q=>recordDict[q]);
    document.getElementById('nextPred1').innerText=`ç®—æ³•1æœ€æ–°${latestQihao+1}æœŸé¢„æµ‹: ${calcPrediction1(latest3)}`;
    document.getElementById('nextPred2').innerText=`ç®—æ³•2æœ€æ–°${latestQihao+1}æœŸé¢„æµ‹: ${calcPrediction2(latest3)}`;

    const winRate = (winCount/testQihaoList.length*100).toFixed(1);
    document.getElementById('winRate').innerText=`å†å²èƒœç‡: ${winRate}% ${(winRate>=80)?'ğŸ”¥æ¨è':''}`;
}

window.onload = loadData;
</script>
</body>
</html>
