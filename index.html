<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>加拿大28历史数据展示</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f8f8f8; margin:0; padding:0; }
h1 { margin-top:20px; font-size:28px; font-weight:bold; }
button { padding:5px 10px; cursor:pointer; font-size:16px; }
table { border-collapse: collapse; margin:auto; width:90%; background:#fff; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; font-weight:bold; }
th { background:#eee; }
</style>
</head>
<body>

<h1>加拿大28历史数据 (最新 25 期)</h1>
<button onclick="loadData()">刷新数据</button>

<table id="historyTable">
    <tr><th>期号</th><th>号码</th><th>和值</th></tr>
</table>

<script>
// 工具函数：数组求和
function sum(arr){ return arr.reduce((a,b)=>a+b,0); }

// 获取单期数据
async function fetchQihao(qihao){
    try{
        const resp = await fetch('https://pc28.me/home/index/getjnd', {
            method:'POST',
            headers: {'Content-Type':'application/x-www-form-urlencoded'},
            body: `qihao=${qihao}`
        });
        const data = await resp.json();
        if(data.code===1) return data.data;
    } catch(e){ console.error(e); }
    return null;
}

// 获取最新期号
async function fetchLatestQihao(){
    try{
        const resp = await fetch('https://pc28.help/kj.json');
        const data = await resp.json();
        if(data.code===1 && data.data.length>0){
            return parseInt(data.data[0].qihao);
        }
    } catch(e){ console.error(e); }
    return null;
}

// 加载历史 25 期
async function loadData(){
    const latestQihao = await fetchLatestQihao();
    if(!latestQihao){ alert("获取最新期号失败"); return; }

    const table = document.getElementById('historyTable');
    table.innerHTML = '<tr><th>期号</th><th>号码</th><th>和值</th></tr>';

    const start = latestQihao - 24; // 最新 + 历史 24 期 = 25 期
    for(let q=start; q<=latestQihao; q++){
        const data = await fetchQihao(q);
        if(data){
            const nums = data.hao.slice(0,3).join(' + ');
            const total = data.he;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${q}</td><td>${nums}</td><td>${total}</td>`;
            table.appendChild(tr);
        }
    }
}
</script>

</body>
</html>
