<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>PC28 预测网站</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 20px; }
h1, h2 { text-align: center; }
table { width: 90%; margin: 10px auto; border-collapse: collapse; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background: #333; color: white; }
tr:nth-child(even) { background: #eee; }
.correct { background: #a4e3a4; font-weight: bold; } /* 对 */
.wrong { background: #f7a4a4; font-weight: bold; }   /* 错 */
.next-prediction { font-size: 1.5em; color: #d35400; text-align: center; margin: 10px; }
.win-rate { text-align: center; font-size: 1.2em; margin: 10px; }
button { display: block; margin: 0 auto 20px; padding: 8px 16px; font-size: 1em; }
</style>
</head>
<body>

<h1>欢迎来到 PC28 预测网站</h1>

<div class="next-prediction" id="nextPrediction">下一期预测加载中...</div>
<div class="win-rate" id="winRate">历史胜率加载中...</div>
<button onclick="loadData()">刷新数据</button>

<h2>最近 20 期预测</h2>
<table id="last20">
<tr><th>期号</th><th>开奖</th><th>预测</th><th>结果</th></tr>
</table>

<h2>历史 100 期胜率</h2>
<table id="history100">
<tr><th>期号</th><th>预测</th><th>结果</th></tr>
</table>

<script>
// 你的 API URL
const BASE_URL = "https://pc28.help"; // 替换为你自己的 API

async function fetchJSON(url) {
  try {
    const resp = await fetch(url);
    if (!resp.ok) throw new Error("网络错误");
    return await resp.json();
  } catch (e) {
    console.error(e);
    return null;
  }
}

async function loadData() {
  document.getElementById("nextPrediction").textContent = "加载中...";
  document.getElementById("winRate").textContent = "加载中...";

  // 假设 API 返回格式为 { data: [...] }
  let latestResp = await fetchJSON(`${BASE_URL}/kj.json`);
  if (!latestResp || !latestResp.data) {
    alert("获取最新开奖失败");
    return;
  }
  let latest = latestResp.data[0];
  const latestQihao = parseInt(latest.qihao);

  // 模拟预测逻辑（用你自己的算法替换）
  function predict(qihao) {
    // 简单示例随机预测
    const types = ["杀小单","杀小双","杀大单","杀大双"];
    return types[qihao % 4];
  }

  // 历史 100 期
  let history100 = [];
  for (let i = 0; i < 100; i++) {
    const q = latestQihao - i;
    let recordResp = await fetchJSON(`${BASE_URL}/qihao/${q}`);
    let open = recordResp && recordResp.data && recordResp.data[0] ? recordResp.data[0].opennum : "";
    let pred = predict(q);
    let result = open ? (Math.random()>0.2 ? "✅" : "❌") : ""; // 模拟对错
    history100.push({ qihao: q, open, pred, result });
  }

  // 最近 20 期
  let last20 = history100.slice(0,20);

  // 渲染最近 20 期
  const table20 = document.getElementById("last20");
  table20.innerHTML = "<tr><th>期号</th><th>开奖</th><th>预测</th><th>结果</th></tr>";
  last20.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.qihao}</td><td>${item.open}</td><td>${item.pred}</td><td class="${item.result==='✅'?'correct':item.result==='❌'?'wrong':''}">${item.result}</td>`;
    table20.appendChild(tr);
  });

  // 渲染历史 100 期
  const table100 = document.getElementById("history100");
  table100.innerHTML = "<tr><th>期号</th><th>预测</th><th>结果</th></tr>";
  history100.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.qihao}</td><td>${item.pred}</td><td class="${item.result==='✅'?'correct':item.result==='❌'?'wrong':''}">${item.result}</td>`;
    table100.appendChild(tr);
  });

  // 计算胜率
  const winCount = history100.filter(x => x.result==='✅').length;
  const winRate = ((winCount / history100.length)*100).toFixed(1);
  document.getElementById("winRate").textContent = `历史胜率：${winRate}%`;

  // 下一期预测
  const nextPred = predict(latestQihao+1);
  document.getElementById("nextPrediction").textContent = `下一期预测：${nextPred}`;
}

// 页面加载自动刷新
window.onload = loadData;
</script>

</body>
</html>
