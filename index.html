<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>PC28 预测网站</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f8f8f8; }
h2 { margin-top:20px; }
button { padding:5px 10px; margin-bottom:20px; cursor:pointer; }
table { border-collapse: collapse; margin:auto; width:90%; background:#fff; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; }
th { background:#eee; }
.correct { color: green; font-weight:bold; }
.wrong { color: red; font-weight:bold; }
footer { margin-top:20px; font-size:14px; }
</style>
</head>
<body>
<h2>欢迎来到 PC28 预测网站</h2>
<button onclick="loadData()">刷新数据</button>

<h3>最近 20 期预测</h3>
<table id="historyTable">
<tr><th>期号</th><th>预测</th><th>开奖和值</th><th>结果</th></tr>
</table>

<h3>下期预测</h3>
<p id="nextPred">加载中...</p>

<h3>历史胜率</h3>
<p id="winRate">加载中...</p>

<footer>CKY预测</footer>

<script>
// fetch JSON
async function fetchJSON(url){
    try {
        const resp = await fetch(url);
        return await resp.json();
    } catch(e){
        console.error(e);
        return null;
    }
}

// 预测算法（根据你给的 Python 改写）
function calcPrediction(last3_nums){
    // last3_nums: array of arrays, [[a,b,c],[...],[...]]
    let a = (sum(last3_nums[2])+last3_nums[2][0])/0.28 +
            (sum(last3_nums[1])+last3_nums[1][0])/0.28 +
            (sum(last3_nums[0])+last3_nums[0][0])/0.28;
    let b = Math.sqrt(a);
    let c = b / 3;
    let decimal = c.toFixed(3).split('.')[1];
    let digitSum = decimal.split('').reduce((s,d)=>s+parseInt(d),0);
    if(digitSum < 14){
        return digitSum%2==0 ? '杀大双':'杀大单';
    } else {
        return digitSum%2==0 ? '杀小双':'杀小单';
    }
}

function sum(arr){ return arr.reduce((a,b)=>a+b,0); }

function checkWin(pred, total){
    let size = total>=14?'大':'小';
    let parity = total%2===1?'单':'双';
    let combination = size+parity;
    if(pred==='杀小单' && combination!=='小单') return '✅';
    if(pred==='杀小双' && combination!=='小双') return '✅';
    if(pred==='杀大单' && combination!=='大单') return '✅';
    if(pred==='杀大双' && combination!=='大双') return '✅';
    return '❌';
}

async function loadData(){
    const latestData = await fetchJSON('https://pc28.help/kj.json');
    if(!latestData || !latestData.data){
        alert("获取数据失败");
        return;
    }
    const latestQihao = parseInt(latestData.data[0].qihao);
    const recordDict = {};

    // 获取最近 23 期数据（保证前3期可预测20期）
    for(let q=latestQihao-22;q<=latestQihao;q++){
        const rec = await fetchJSON(`https://pc28.help/qihao/${q}`);
        if(rec && rec.data){
            const nums = rec.data[0].opennum.replace(/,/g,'+').split('+').map(Number).slice(0,3);
            if(nums.length>=3) recordDict[q] = nums;
        }
    }

    const sortedQihao = Object.keys(recordDict).map(Number).sort((a,b)=>a-b);
    const historyTable = document.getElementById('historyTable');
    historyTable.innerHTML='<tr><th>期号</th><th>预测</th><th>开奖和值</th><th>结果</th></tr>';

    let winCount=0;
    const testQihaoList = sortedQihao.slice(-20);

    for(let curQihao of testQihaoList){
        const prevQihaos = sortedQihao.filter(q=>q<curQihao);
        if(prevQihaos.length<3) continue;
        const last3_nums = prevQihaos.slice(-3).map(q=>recordDict[q]);
        const pred = calcPrediction(last3_nums);
        const total = sum(recordDict[curQihao]);
        const res = checkWin(pred,total);
        if(res==='✅') winCount++;
        const tr = document.createElement('tr');
        tr.innerHTML=`<td>${curQihao}</td><td>${pred}</td><td>${total}</td><td class="${res==='✅'?'correct':'wrong'}">${res}</td>`;
        historyTable.appendChild(tr);
    }

    const winRate = (winCount/20*100).toFixed(1);
    document.getElementById('winRate').innerText=`历史胜率: ${winRate}%`;

    // 下期预测
    const latestThree = sortedQihao.slice(-3).map(q=>recordDict[q]);
    const nextPred = calcPrediction(latestThree);
    document.getElementById('nextPred').innerText=`${latestQihao+1}期预测: ${nextPred}`;
}

loadData();
</script>
</body>
</html>
<script>
// 你的 API URL
const BASE_URL = "https://pc28.help"; // 替换为你自己的 API

async function fetchJSON(url) {
  try {
    const resp = await fetch(url);
    if (!resp.ok) throw new Error("网络错误");
    return await resp.json();
  } catch (e) {
    console.error(e);
    return null;
  }
}

async function loadData() {
  document.getElementById("nextPrediction").textContent = "加载中...";
  document.getElementById("winRate").textContent = "加载中...";

  // 假设 API 返回格式为 { data: [...] }
  let latestResp = await fetchJSON(`${BASE_URL}/kj.json`);
  if (!latestResp || !latestResp.data) {
    alert("获取最新开奖失败");
    return;
  }
  let latest = latestResp.data[0];
  const latestQihao = parseInt(latest.qihao);

  // 模拟预测逻辑（用你自己的算法替换）
  function predict(qihao) {
    // 简单示例随机预测
    const types = ["杀小单","杀小双","杀大单","杀大双"];
    return types[qihao % 4];
  }

  // 历史 100 期
  let history100 = [];
  for (let i = 0; i < 100; i++) {
    const q = latestQihao - i;
    let recordResp = await fetchJSON(`${BASE_URL}/qihao/${q}`);
    let open = recordResp && recordResp.data && recordResp.data[0] ? recordResp.data[0].opennum : "";
    let pred = predict(q);
    let result = open ? (Math.random()>0.2 ? "✅" : "❌") : ""; // 模拟对错
    history100.push({ qihao: q, open, pred, result });
  }

  // 最近 20 期
  let last20 = history100.slice(0,20);

  // 渲染最近 20 期
  const table20 = document.getElementById("last20");
  table20.innerHTML = "<tr><th>期号</th><th>开奖</th><th>预测</th><th>结果</th></tr>";
  last20.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.qihao}</td><td>${item.open}</td><td>${item.pred}</td><td class="${item.result==='✅'?'correct':item.result==='❌'?'wrong':''}">${item.result}</td>`;
    table20.appendChild(tr);
  });

  // 渲染历史 100 期
  const table100 = document.getElementById("history100");
  table100.innerHTML = "<tr><th>期号</th><th>预测</th><th>结果</th></tr>";
  history100.forEach(item => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.qihao}</td><td>${item.pred}</td><td class="${item.result==='✅'?'correct':item.result==='❌'?'wrong':''}">${item.result}</td>`;
    table100.appendChild(tr);
  });

  // 计算胜率
  const winCount = history100.filter(x => x.result==='✅').length;
  const winRate = ((winCount / history100.length)*100).toFixed(1);
  document.getElementById("winRate").textContent = `历史胜率：${winRate}%`;

  // 下一期预测
  const nextPred = predict(latestQihao+1);
  document.getElementById("nextPrediction").textContent = `下一期预测：${nextPred}`;
}

// 页面加载自动刷新
window.onload = loadData;
</script>

</body>
</html>
